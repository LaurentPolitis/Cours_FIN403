---
title: "Data Visualisation"
author: "Laurent Politis"
date: "`r format(Sys.Date(),  'Le %d %B %Y')`"
output:
  ioslides_presentation:
    fig_caption: yes
    highlight: tango
    incremental: yes
    logo: image/Logo_Essca.jpg
  beamer_presentation:
    highlight: tango
    incremental: yes
  slidy_presentation:
    highlight: tango
    incremental: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```



## Introduction
Ce cours est un TD informatique constitue d'exemples et d'exercices du langage de programmation R sur la data visualisation.
Les differents points abordes durant ces 15 heures de cours sont : 

- Extraction et manipulation des donnees (data mining)
- Representations graphiques 
- Valorisations de ces donnees par le biais de methodes statistiques et de visualisations
- Representations graphiques interactives (html widget, plotly ...)
- Shiny et R markdown creation d'application et de rapport interactif 


## $1^{er}$ cours

**Extraction et manipulation de donn?es (data mining)**

- G?n?ralit? sur la data visualisation
- Rappels sur R 
  * Objets R (variable, programme et fonction)
  * importer des donn?es depuis le web 
  * graphiques simples


##  Data visualation   

Definition

- communique des donnees de facon visuelle

- 
[<img src="C:/Users/Laurent/Pictures/volcan_chauvet.png" height="200px" width="500px" /> ](https://www.google.fr/url?sa=t&rct=j&q=&esrc=s&source=web&cd=3&cad=rja&uact=8&ved=0ahUKEwifmvOmyLTLAhVpGZoKHfHTCVIQFggtMAI&url=http%3A%2F%2Fwww.hominides.com%2Fhtml%2Factualites%2Fvolcan-chauvet-art-parietal-0997.php&usg=AFQjCNEkHHN2mcgvHqIeMiFzsxQeHOghKw&sig2=M_S-Hnbu-FnwG4XA6kE_yg)

- transformer  des donnees en information

- resultats graphiques clairs et comprehensibles 



## Exemple 


- <img src="C:/Users/Laurent/Pictures/Minard.png" height="250px" width="800px" />
[un des meilleurs graphiques statistiques](https://fr.wikipedia.org/wiki/Charles_Joseph_Minard)

- http://esri.github.io/wind-js/ SIG

- http://flowingdata.com/2016/01/05/causes-of-death/ s?ries temporelles 

- http://www.nytimes.com/interactive/2015/03/19/upshot/3d-yield-curve-economic-growth.html 3D 

##Principes d'infographie

 - memoire courte quelques secondes d'attention ou de reflexion
 - un max de $\simeq 11$ types de couleurs ou de styles diff?rents facilement distinguables 
 - notion de perspective donn?es et v?rit?s 

 

- <img src="C:/Users/Laurent/Pictures/pay_rolls.PNG" height="290px" width="490px" />
source "How to Lie With Statistics", 1954, *Huff*

## Science sous jacente les statistiques 
<img src="C:/Users/Laurent/Pictures/huff1.jpg" height="450px" width="400px" />
source "How to Lie With Statistics", 1954, *Huff*


## Un graphique vaut mille mots 

```{r motss}
library(ggplot2)
df = data.frame(x=rnorm(1:84),y=rnorm(1:84),
                lettres=LETTERS[rep(seq( from = 1, to = 28 ),3)])

df[!complete.cases(df),"lettres"]="A"
df$test= ifelse(df$lettres=="A","A","pas A")
ggplot(df,aes(x=x,y=y))+geom_text(aes(label=lettres))
#ggplot(df,aes(x=x,y=y,colour=test))+geom_text(aes(label=lettres))

```

## Combien y a t il de A ?  


```{r mot1}
ggplot(df,aes(x=x,y=y,colour=test,size=test))+geom_text(aes(label=lettres))+labs(colour="",size="")+scale_color_manual(values = c("red","black"))+scale_size_manual(values = c(6.5,4))

```

* R?ponse : 9

<!-- ## Regardons le code  -->

<!-- ```{r mot_description, echo=TRUE, message=TRUE,eval=FALSE} -->
<!-- # Partie setup  -->
<!-- library(ggplot2) -->

<!-- # Partie data mining et calcul  -->

<!-- df = data.frame(x=rnorm(1:87),y=rnorm(1:87), -->
<!--                 lettres=LETTERS[rep(seq( from = 1, to = 27 ),3)]) -->
<!-- df[!complete.cases(df),"lettres"]="A" -->
<!-- df$test= ifelse(df$lettres=="A","A","pas A") -->


<!-- # Partie data visualisation -->

<!-- ggplot(df,aes(x=x,y=y))+geom_text(aes(label=lettres)) -->
<!-- #ggplot(df,aes(x=x,y=y,colour=test))+geom_text(aes(label=lettres)) -->

<!-- ``` -->



## Pourquoi R 

- Open source & Gratuit 
- Facile ? installer sur les syst?mes d'exploitations Linux, Windows et Apple 
- Une tr?s grosse communaut? de d?veloppeurs et d'utilisateurs 
- Facile ? utiliser pour des non-programmeurs pour des calculs statistiques 
- Possibilit? de cr?er de belles illustrations, applications web et m?me la pr?sentation que vous lisez actuellement 
          <img src="C:/Users/Laurent/Pictures/run_Paris.png" height="200px" width="400px" /> 

## Installation de R 


**Sur Windows**

aller ? l'url http://cran.r-project.org/bin/windows/base/  et t?l?charger la derni?re version de R en fonction de votre ordinateur 32 bit ou 64 bit (pour le savoir aller sur *param?tres>syst?me>information syst?me*)


**Sur Apple**

http://cran.r-project.org/bin/macosx/ et t?l?charger la derni?re version de R

**Pour installer Rstudio**


 http://www.rstudio.com/ide/ pour t?l?charger la derni?re version et installer l'environnement de travail *R studio* en suivant les indications du site

##  Pour ?tre bon en R ...



- savoir demander de l'aide  la qualit? principale d'un programmeur (90% de ses comp?tences)

  * [stack overflow](http://stackoverflow.com/) forum en ligne
  * suivre des exemples  R blogger, git_hub ...
  * commandes  en console R `??` et `?` 
  * utiliser un environnement de travail int?gr? (IDE) comme Rstudio (facilite la programmation, auto indentation, variables historiques, etc ...)

## Pr?sentation de Rstudio 
  <img src="C:/Users/Laurent/Pictures/IDE.PNG" height="400px" width="800px" />


## Codes sources, programmes et scripts 
  <img src="C:/Users/Laurent/Pictures/IDE_1.PNG" height="400px" width="800px" />
  

## Codes sources, programmes et scripts 

- cr?er un fichier texte hello.R 
- ?crire votre  premier programme en R

```{r premier_prog, echo=TRUE, message=TRUE,eval=FALSE}
#  le Di?se sert ? commenter le reste de la la ligne  
# tout ce qui est ?crit ici ne sera pas ex?cut? par R  
# indiquer le but du programme ou toutes autres informations  
# Nom  et Pr?nom dates 
a <- "hello World ! "

print(a)


```



## Comment l'ex?cuter ? 

A l'aide de la console R : 

  <img src="C:/Users/Laurent/Pictures/IDE_2.PNG" height="330px" width="800px" />
  
```{r premier_prog_console, echo=TRUE, message=TRUE,eval=TRUE}
source("cours_data_visualisation//hello.R")

```

## L'environnement de R 

Ce qui a chang? 

  <img src="C:/Users/Laurent/Pictures/IDE4.PNG" height="300px" width="800px" />
  
* Ajout de la commande lanc?e dans la console R dans l'historique 
* Ajout de la variable `a` dans l'environnement R (commande ls() pour lister les objets)

## Les variables dans R 

```{r console, echo=TRUE, message=TRUE,eval=TRUE}
class(a)

b <- 1 
class(b)

#vecteurs
c <- c(1,2,3,4)
d <- c("a","b","c","d")
e <- c("a"=1,"b"=2,"c"=3,"d"=4)
f <- c(1,"a","d",4)
```

## Les variables dans R suite 


```{r variables, echo=TRUE, message=TRUE,eval=TRUE}
class(c)
class(d)
class(e)
class(f)
```
 attention f ne pas m?langer les types de variables

## Les Matrices 

```{r matrix, echo=TRUE, message=TRUE}
  f.m <- cbind(f)
f.m
  c.m <- cbind(c)
  c.m
  
 
```
## Matrices num?riques ou  caract?res
```{r matrix1, echo=TRUE, message=TRUE}
  m.m <- cbind(f.m,c.m)
    m.m
        n.m <- cbind(c.m,c.m)
        n.m

```
Limitation des matrices soit type num?rique ou  caract?re

## Matrices et Data frames
```{r dataframe, echo=TRUE, message=TRUE}
mat <- matrix(data = c.m, ncol=4,nrow = 3)
mat
df = data.frame("numeriques"= c, lettres=f,stringsAsFactors = F)
df 
```

## Matrices et Data frames

```{r dataframe1, echo=TRUE, message=TRUE}
class(mat[,1])
class(df[,"numeriques"])
class(df[,"lettres"])
```

## Passer d'un type ? l'autre
```{r as, echo=TRUE, message=TRUE}
as.matrix(df)

as.numeric(f)

```

## Relation logique
```{r logique, echo=TRUE, message=TRUE}
1==0
1>=0
1<=0
"a" == "b"
```

## Fonctions 
les commandes matrix(), cbind(), data.frame() sont des fonctions cod?es 

**D?finition**

[<img src="C:/Users/Laurent/Pictures/fonction_R.png" height="150px" width="600px" />](http://biol09.biol.umontreal.ca/BIO2041e/CreerFonctionR.pdf)


* un objet R
* des commandes R ?crites dans un fichier qui effectuent une t?che pr?d?finie
* permet de faire automatiquement la m?me t?che plusieurs fois 
* garder un programme plus lisible 
* un gain de temps ? long terme 

## Ecrire votre premi?re fonction 
 ?crire le m?me code que pr?c?demment sous forme de fonction dans un nouveau fichier hello_fun.R

```{r fonction2, echo=TRUE, message=TRUE}
hello <-function(texte=NULL){   # argument ou donn?es d'entr?e

  #code manipulant les donn?es d'entr?e
 
return(texte)  #  return  renvoie le r?sultat de la fonction  
}
 source("cours_data_visualisation/hello_fun.R")

 hello("hello world !")
```

## Un peu plus complique 
un petit ajout le nom de l'utilisateur
 
```{r fonction1, echo=TRUE, message=TRUE}
hello <-function(texte=NULL){  
  #on souhaite coller le nom de l'utilisateur ? "hello world"
  # on r?cup?re le nom de l'utilisateur 
 nom <- Sys.getenv("USERNAME") # fonction trouv?e via une recherche web
   # on colle le nom de l'utilisateur
 texte <- paste(nom,texte)
 
return(texte)  #  return  renvoie le r?sultat de la fonction  
}

 source("cours_data_visualisation/hello_fun2.R")

 hello("hello world !")
```

## Fonction cor()

Vous avez ?crit une fonction comme les fonctions de base de R exemple cor() qui calcule la corr?lation des donn?es de 2 vecteurs ou des donn?es contenues dans une matrice 

```{r fonction, echo=TRUE, message=TRUE}
cor
```

## Importer des donn?es  
Importer des donn?es via [quandl](https://www.quandl.com/)

Par exemple l'?volution de la population ? Angers 

https://www.quandl.com/data/INSEE/29_000067684_A-Demography-Municipal-population-at-the-census-Angers

* T?l?charger les donn?es sous format .csv 
* ouvrir les donn?es via R m?thode graphique 
![Import Dataset > from Local File](C:/Users/Laurent/Pictures/IDE5.PNG)

## Importer des donn?es  sous R 

Import Dataset > from Local File
![Import Dataset > from Local File](C:/Users/Laurent/Pictures/IDE6.PNG)

Puis v?rifier que les donn?es sont sous le bon format 

<img src="C:/Users/Laurent/Pictures/IDE7.png" height="220px" width="300px" />

## Importer des donn?es sous console R 

```{r importer,  echo=TRUE, message=TRUE}
read.csv("C:/Users/Laurent/Downloads/INSEE-29_000067684_A.csv")

class(read.csv("C:/Users/Laurent/Downloads/INSEE-29_000067684_A.csv"))

```


## Visualiser les donn?es
```{r view,echo=TRUE, message=TRUE,eval=FALSE}
INSEE.29_000067684_A <- read.csv("C:/Users/Laurent/Downloads/
                                 INSEE-29_000067684_A.csv")
View(INSEE.29_000067684_A)
```

```{r,echo=FALSE, message=FALSE,eval=TRUE}
INSEE.29_000067684_A <- read.csv("C:/Users/Laurent/Downloads/INSEE-29_000067684_A.csv")
```
<img src="C:/Users/Laurent/Pictures/IDE8.png" height="280px" width="300px" />

## Visualiser les donn?es
```{r plot,echo=TRUE, message=TRUE,eval=TRUE}
plot(x = as.Date(INSEE.29_000067684_A$Date),y=
       INSEE.29_000067684_A$Value)

```

## Changer  le style du graphe
```{r plot1,echo=TRUE, message=TRUE,eval=TRUE}
plot(x = as.Date(INSEE.29_000067684_A$Date),y=
       INSEE.29_000067684_A$Value,type = "l")

```

## Changer  le style du graphe
```{r plot3,echo=TRUE, message=TRUE,eval=TRUE}
plot(x = as.Date(INSEE.29_000067684_A$Date),y=
       INSEE.29_000067684_A$Value,type = "b")

```


## L?gendes
```{r plot2,echo=TRUE, message=TRUE,eval=TRUE}
plot(x = as.Date(INSEE.29_000067684_A$Date),y=
       INSEE.29_000067684_A$Value,type = "l",xlab ="Dates" ,
     ylab="populations")

```



